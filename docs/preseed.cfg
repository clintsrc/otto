# Target disk
d-i partman-auto/disk string /dev/nvme0n1

# Remove old LVM and RAID metadata
d-i partman-lvm/device_remove_lvm boolean true
d-i partman-md/device_remove_md boolean true

# Partitioning method â€” let it handle auto partitioning with LVM
d-i partman-auto/method string lvm

# Partitioning recipe
d-i partman-auto/expert_recipe string                         \
  mylvmrecipe ::                                              \
    512 512 512 fat32                                         \
      $primary{ } $bootable{ } method{ efi } format{ }       \
      use_filesystem{ } filesystem{ fat32 } mountpoint{ /boot/efi } . \
    550 550 550 ext4                                          \
      $primary{ } method{ format } format{ }                 \
      use_filesystem{ } filesystem{ ext4 } mountpoint{ /boot } . \
    10000 10000 10000 lvm                                     \
      method{ lvm } format{ } .                               \
    10000 10000 10000 ext4                                    \
      method{ lvm } use_filesystem{ } filesystem{ ext4 } mountpoint{ / } . \
    2048 2048 2048 linux-swap                                 \
      method{ swap } format{ } .                              \
    4096 4096 -1 ext4                                         \
      method{ lvm } use_filesystem{ } filesystem{ ext4 } mountpoint{ /home } .

# Select and confirm
d-i partman-auto/choose_recipe select mylvmrecipe
d-i partman-auto/confirm boolean true
d-i partman-auto/confirm_nooverwrite boolean true

d-i partman-partitioning/confirm_write_new_label boolean true
d-i partman/choose_partition select finish
d-i partman/confirm boolean true
d-i partman/confirm_nooverwrite boolean true

d-i partman-lvm/confirm boolean true
d-i partman-lvm/confirm_nooverwrite boolean true

